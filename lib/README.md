# Contents
    - [⚙️PCA9685](#⚙️PCA9685)
        - [🔩PCA9685の周波数を50Hz用に設定する（1/50sに4096のパルスが入るようにprescaleを設定）](#🔩PCA9685の周波数を50Hz用に設定する（1/50sに4096のパルスが入るようにprescaleを設定）)
        - [🔩PWMパルスのオンとオフのタイミングを指定する](#🔩PWMパルスのオンとオフのタイミングを指定する)
            - [🚀 MG996R](#🚀-MG996R)
            - [🚀 DS3218](#🚀-DS3218)
            - [🚀 HS-5086WP](#🚀-HS-5086WP)
        - [🔩servomotorクラス](#🔩servomotorクラス)
        - [🔩MG996R](#🔩MG996R)
        - [🔩servomotorクラス](#🔩servomotorクラス)
        - [🔩MG996R](#🔩MG996R)


---
## ⚙️PCA9685 

* PWMの周波数を生成するようPCA9685を設定する方法
* デューティーサイクルを決める，PWMパルスのオンとオフのタイミングを指定する方法

### 🔩PCA9685の周波数を50Hz用に設定する（1/50sに4096のパルスが入るようにprescaleを設定） 

PCA9685の内部クロック周波数は25MHz．
PWM周期$`T _{\rm PWM}`$の中に4096個のステップが入るようにprescale, $p$を設定する．
いいかえると，1秒間に$`4096/T _{\rm PWM}=4096 f _{\rm PWM}`$回のステップがはいるようにPCA9685のクロックを設定する．
これには，以下の式を満たすようにprescaleを設定すればよいことがわかる．

```math
\begin{align*}
4096 f _{\rm PWM} &= 25M / (p+1)\\
\rightarrow p &= \frac{25M}{4096 f _{\rm PWM}} - 1
\end{align*}
```

prescaleは整数でなければならないので，`round`で四捨五入する．

### 🔩PWMパルスのオンとオフのタイミングを指定する 

多くの場合，
設定したい[パルス幅[s],角度]の情報をもとに，パルス幅[s]をステップ<4096に変換して，PCA9685に送る．
パルス幅$`\Delta t`$をステップ数に変換するには，

#### 🚀 MG996R 

| パルス幅 (s) | 角度 |
|---|---|
| 1.0 ms | 0° |
| 1.5 ms | 90° |
| 2.0 ms | 180° |

#### 🚀 DS3218 

| パルス幅 (s) | 角度 |
|---|---|
| 0.5 ms | 0° |
| 1.5 ms | 90° |
| 2.5 ms | 180° |

#### 🚀 HS-5086WP 

| パルス幅 (s) | 角度 |
|---|---|
| 0.9 ms | 0° |
| 1.5 ms | 90° |
| 2.1 ms | 180° |

$`4096 * \Delta t / T _{\rm PWM}`$を計算すればよい．

[./PCA9685/PCA9685 copy.py#L1](./PCA9685/PCA9685 copy.py#L1)

---
### 🔩servomotorクラス 

このservomotorクラスは，`servomotor(チャンネル, オフセット角度)`で初期化する．
例えば，以下のようにすると，チャンネル0のサーボモーターを初期角度90度で初期化できる．

```
s = servomotor(0, 90)
```

角度を変更するには，`setDegree`を使う．例えば，以下のようにすると，チャンネル0のサーボモーターの角度を180度に変更できる．

```
s.setDegree(180)
```

### 🔩MG996R 

6Vで11kgf-cmのトルクを持つ．
$`\plusmn 60^\circ`$の範囲で動作する．

PWM周期は20ms，つまり周波数は1/20=50Hz．

1.5msのパルス幅で中立位置，0.5msで最小角度，2.5msで最大角度．

[./servomotor/servomotor.py#L10](./servomotor/servomotor.py#L10)

### 🔩servomotorクラス 

このservomotorクラスは，`servomotor(チャンネル, オフセット角度)`で初期化する．
例えば，以下のようにすると，チャンネル0のサーボモーターを初期角度90度で初期化できる．

```
s = servomotor(0, 90)
```

角度を変更するには，`setDegree`を使う．例えば，以下のようにすると，チャンネル0のサーボモーターの角度を180度に変更できる．

```
s.setDegree(180)
```

### 🔩MG996R 

6Vで11kgf-cmのトルクを持つ．
$`\plusmn 60^\circ`$の範囲で動作する．

PWM周期は20ms，つまり周波数は1/20=50Hz．

1.5msのパルス幅で中立位置，0.5msで最小角度，2.5msで最大角度．

[./servomotor/servomotor20240730.py#L10](./servomotor/servomotor20240730.py#L10)

---
